(window.webpackJsonp=window.webpackJsonp||[]).push([[178],{392:function(s,a,e){"use strict";e.r(a);var t=e(2),n=Object(t.a)({},function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"pagecloudplus-tidb-cluster"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#pagecloudplus-tidb-cluster","aria-hidden":"true"}},[s._v("#")]),s._v(" PageCloudPlus TiDB Cluster")]),s._v(" "),e("h2",{attrs:{id:"环境准备"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#环境准备","aria-hidden":"true"}},[s._v("#")]),s._v(" 环境准备")]),s._v(" "),e("p",[s._v("部署前，请确认软件、资源等满足如下需求：")]),s._v(" "),e("ul",[e("li",[s._v("资源需求 CPU 2+，Memory 4G+")]),s._v(" "),e("li",[s._v("Docker：>= 17.03")]),s._v(" "),e("li",[s._v("Helm Client： 版本 >= 2.9.0 并且 < 3.0.0")]),s._v(" "),e("li",[s._v("Kubectl：至少 1.10，建议 1.13 或更高版本")]),s._v(" "),e("li",[s._v("对于 Linux 用户， 如果使用 5.x 或者更高版本内核，安装过程中 "),e("code",[s._v("kubeadm")]),s._v(" 可能会打印警告信息。集群可能仍然能正常工作，但是为保证更好的兼容性，建议使用 3.10+ 或者 4.x 版本内核。")]),s._v(" "),e("li",[s._v("需要 "),e("code",[s._v("root")]),s._v(" 权限操作 Docker 进程")])]),s._v(" "),e("h2",{attrs:{id:"部署-tidb-operator"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#部署-tidb-operator","aria-hidden":"true"}},[s._v("#")]),s._v(" 部署 TiDB Operator")]),s._v(" "),e("blockquote",[e("p",[e("strong",[s._v("注意：")]),s._v(" ${chartVersion} 在后续文档中代表 chart 版本，例如 v1.0.0-rc.1")])]),s._v(" "),e("p",[s._v("如果 K8s 集群启动并正常运行，可以通过 "),e("code",[s._v("helm")]),s._v(" 添加 chart 仓库并安装 TiDB Operator。")]),s._v(" "),e("ul",[e("li",[s._v("添加 Helm chart 仓库")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("helm repo "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" pingcap http://charts.pingcap.org/ "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" \\\nhelm repo list "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" \\\nhelm repo update "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" \\\nhelm search tidb-cluster -l "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" \\\nhelm search tidb-operator -l\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("ul",[e("li",[s._v("安装 TiDB Operator")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("helm "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" charts/tidb-operator --name"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("tidb-operator --namespace"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("tidb-admin --set scheduler.kubeSchedulerImageName"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("registry.aliyuncs.com/google_containers/kube-scheduler --version"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("v1.0.0-rc.1\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("等待几分钟确保 TiDB Operator 正常运行")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("kubectl get pods --namespace tidb-admin -l app.kubernetes.io/instance"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("tidb-operator\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 输出如下")]),s._v("\nNAME                                      READY   STATUS    RESTARTS   AGE\ntidb-controller-manager-97dc98b6c-hmlp5   1/1     Running   0          118s\ntidb-scheduler-648f7bc6c8-qdss5           2/2     Running   0          119s\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("h2",{attrs:{id:"部署本地卷"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#部署本地卷","aria-hidden":"true"}},[s._v("#")]),s._v(" 部署本地卷")]),s._v(" "),e("ul",[e("li",[s._v("由于上一章节并没有真正部署 PV，我们先卸载 TiDB "),e("code",[s._v("local-volume-provisioner.yaml")])])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("kubectl delete -f manifests/local-dind/local-volume-provisioner.yaml\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("blockquote",[e("p",[e("strong",[s._v("注意：")]),s._v(" 以下步骤需要在所有 Node 节点分别执行")])]),s._v(" "),e("ul",[e("li",[s._v("为虚拟机添加新的磁盘")])]),s._v(" "),e("p",[e("img",{attrs:{src:"https://p-blog.gitee.io/pic-repo/images/kubernetes/kube1e2a157961caee6b.png",alt:""}})]),s._v(" "),e("ul",[e("li",[s._v("查看新磁盘")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("fdisk")]),s._v(" -l\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可以看到磁盘路径为 /dev/sdb")]),s._v("\nDisk /dev/sdb: 40 GiB, 42949672960 bytes, 83886080 sectors\nUnits: sectors of 1 * 512 "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 512 bytes\nSector size "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("logical/physical"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": 512 bytes / 512 bytes\nI/O size "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("minimum/optimal"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": 512 bytes / 512 bytes\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("ul",[e("li",[s._v("参考 "),e("a",{attrs:{href:"http://www.qfdmy.com/wp-content/themes/quanbaike/go.php?url=aHR0cHM6Ly9naXRodWIuY29tL2t1YmVybmV0ZXMtc2lncy9zaWctc3RvcmFnZS1sb2NhbC1zdGF0aWMtcHJvdmlzaW9uZXIvYmxvYi9tYXN0ZXIvZG9jcy9vcGVyYXRpb25zLm1k",target:"_blank",rel:"noopener noreferrer"}},[s._v("operations guide in sig-storage-local-static-provisioner"),e("OutboundLink")],1),s._v("，"),e("code",[s._v("tidb-operator")]),s._v(" 启动会为 "),e("code",[s._v("pd")]),s._v(" 和 "),e("code",[s._v("tikv")]),s._v(" 绑定 "),e("code",[s._v("pv")]),s._v("，需要在 "),e("code",[s._v("discovery directory")]),s._v(" 下创建多个目录")]),s._v(" "),e("li",[s._v("格式化磁盘")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" mkfs.ext4 /dev/sdb\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 输出如下")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("mke2fs")]),s._v(" 1.44.1 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("24-Mar-2018"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nCreating filesystem with 10485760 4k blocks and 2621440 inodes\nFilesystem UUID: 5ace0751-6870-4115-89d4-91e007d8b055\nSuperblock backups stored on blocks: \n        32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208, \n        4096000, 7962624\nAllocating group tables: "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("                            \nWriting inode tables: "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("                            \nCreating journal "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("65536 blocks"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\nWriting superblocks and filesystem accounting information: "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br")])]),e("ul",[e("li",[s._v("挂载磁盘")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("DISK_UUID"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("blkid -s UUID -o value /dev/sdb"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /mnt/"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$DISK_UUID")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("mount")]),s._v(" -t ext4 /dev/sdb /mnt/"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$DISK_UUID")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("ul",[e("li",[e("code",[s._v("/etc/fstab")]),s._v(" 持久化 "),e("code",[s._v("mount")])])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("echo")]),s._v(" UUID"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" blkid -s UUID -o value /dev/sdb"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v(" /mnt/"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$DISK_UUID")]),s._v(" ext4 defaults 0 2 "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("tee")]),s._v(" -a /etc/fstab\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 输出如下")]),s._v("\nUUID"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("58759186-ffab-42a3-96ce-f9d3c355d4d1 /mnt/58759186-ffab-42a3-96ce-f9d3c355d4d1 ext4 defaults 0 2\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("ul",[e("li",[s._v("创建多个目录并 "),e("code",[s._v("mount")]),s._v(" 到 "),e("code",[s._v("discovery directory")])])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" i "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("seq")]),s._v(" 1 10"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /mnt/"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${DISK_UUID}")]),s._v("/vol"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${i}")]),s._v(" /mnt/disks/"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${DISK_UUID}")]),s._v("_vol"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${i}")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("mount")]),s._v(" --bind /mnt/"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${DISK_UUID}")]),s._v("/vol"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${i}")]),s._v(" /mnt/disks/"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${DISK_UUID}")]),s._v("_vol"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${i}")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("ul",[e("li",[e("code",[s._v("/etc/fstab")]),s._v(" 自动挂载")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" i "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("seq")]),s._v(" 1 10"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("echo")]),s._v(" /mnt/"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${DISK_UUID}")]),s._v("/vol"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${i}")]),s._v(" /mnt/disks/"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${DISK_UUID}")]),s._v("_vol"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${i}")]),s._v(" none bind 0 0 "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("tee")]),s._v(" -a /etc/fstab\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 输出如下")]),s._v("\n/mnt/58759186-ffab-42a3-96ce-f9d3c355d4d1/vol1 /mnt/disks/58759186-ffab-42a3-96ce-f9d3c355d4d1_vol1 none bind 0 0\n/mnt/58759186-ffab-42a3-96ce-f9d3c355d4d1/vol2 /mnt/disks/58759186-ffab-42a3-96ce-f9d3c355d4d1_vol2 none bind 0 0\n/mnt/58759186-ffab-42a3-96ce-f9d3c355d4d1/vol3 /mnt/disks/58759186-ffab-42a3-96ce-f9d3c355d4d1_vol3 none bind 0 0\n/mnt/58759186-ffab-42a3-96ce-f9d3c355d4d1/vol4 /mnt/disks/58759186-ffab-42a3-96ce-f9d3c355d4d1_vol4 none bind 0 0\n/mnt/58759186-ffab-42a3-96ce-f9d3c355d4d1/vol5 /mnt/disks/58759186-ffab-42a3-96ce-f9d3c355d4d1_vol5 none bind 0 0\n/mnt/58759186-ffab-42a3-96ce-f9d3c355d4d1/vol6 /mnt/disks/58759186-ffab-42a3-96ce-f9d3c355d4d1_vol6 none bind 0 0\n/mnt/58759186-ffab-42a3-96ce-f9d3c355d4d1/vol7 /mnt/disks/58759186-ffab-42a3-96ce-f9d3c355d4d1_vol7 none bind 0 0\n/mnt/58759186-ffab-42a3-96ce-f9d3c355d4d1/vol8 /mnt/disks/58759186-ffab-42a3-96ce-f9d3c355d4d1_vol8 none bind 0 0\n/mnt/58759186-ffab-42a3-96ce-f9d3c355d4d1/vol9 /mnt/disks/58759186-ffab-42a3-96ce-f9d3c355d4d1_vol9 none bind 0 0\n/mnt/58759186-ffab-42a3-96ce-f9d3c355d4d1/vol10 /mnt/disks/58759186-ffab-42a3-96ce-f9d3c355d4d1_vol10 none bind 0 0\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br")])]),e("ul",[e("li",[s._v("为 "),e("code",[s._v("tidb-operator")]),s._v(" 创建 "),e("code",[s._v("local-volume-provisioner")])])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("kubectl apply -f manifests/local-dind/local-volume-provisioner.yaml\nkubectl get po -n kube-system -l app"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("local-volume-provisioner\nkubectl get "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("pv")]),s._v(" --all-namespaces "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" local-storage\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 输出如下")]),s._v("\nlocal-pv-105327f3   39Gi       RWO            Delete           Available                                   local-storage            91s\nlocal-pv-137dd513   39Gi       RWO            Delete           Available                                   local-storage            91s\nlocal-pv-198df81a   39Gi       RWO            Delete           Available                                   local-storage            92s\nlocal-pv-1ccfc7b8   39Gi       RWO            Delete           Available                                   local-storage            92s\nlocal-pv-1eedfd0c   39Gi       RWO            Delete           Available                                   local-storage            92s\nlocal-pv-21ebe8d3   39Gi       RWO            Delete           Available                                   local-storage            92s\nlocal-pv-26700c8c   39Gi       RWO            Delete           Available                                   local-storage            91s\nlocal-pv-2c866a2b   39Gi       RWO            Delete           Bound       tidb/tikv-tidb-cluster-tikv-1   local-storage            90s\nlocal-pv-332165f7   39Gi       RWO            Delete           Available                                   local-storage            91s\nlocal-pv-337dc036   39Gi       RWO            Delete           Available                                   local-storage            91s\nlocal-pv-5160f51f   39Gi       RWO            Delete           Available                                   local-storage            92s\nlocal-pv-67727d25   39Gi       RWO            Delete           Available                                   local-storage            91s\nlocal-pv-68796375   39Gi       RWO            Delete           Available                                   local-storage            92s\nlocal-pv-6a58a870   39Gi       RWO            Delete           Available                                   local-storage            91s\nlocal-pv-6e6794e6   39Gi       RWO            Delete           Available                                   local-storage            92s\nlocal-pv-794165b7   39Gi       RWO            Delete           Available                                   local-storage            91s\nlocal-pv-7f623e89   39Gi       RWO            Delete           Available                                   local-storage            91s\nlocal-pv-81dad462   39Gi       RWO            Delete           Available                                   local-storage            92s\nlocal-pv-9af9c126   39Gi       RWO            Delete           Available                                   local-storage            91s\nlocal-pv-a3786a90   39Gi       RWO            Retain           Bound       tidb/pd-tidb-cluster-pd-2       local-storage            92s\nlocal-pv-b974816a   39Gi       RWO            Retain           Bound       tidb/tikv-tidb-cluster-tikv-0   local-storage            92s\nlocal-pv-bc37b3dd   39Gi       RWO            Delete           Available                                   local-storage            91s\nlocal-pv-c975c109   39Gi       RWO            Delete           Available                                   local-storage            91s\nlocal-pv-db3102fc   39Gi       RWO            Delete           Available                                   local-storage            91s\nlocal-pv-e1afde46   39Gi       RWO            Retain           Bound       tidb/pd-tidb-cluster-pd-1       local-storage            91s\nlocal-pv-e2f4bb4d   39Gi       RWO            Delete           Available                                   local-storage            91s\nlocal-pv-e59e55a8   39Gi       RWO            Retain           Bound       tidb/pd-tidb-cluster-pd-0       local-storage            91s\nlocal-pv-ece22d2    39Gi       RWO            Delete           Available                                   local-storage            90s\nlocal-pv-ecf4dd59   39Gi       RWO            Delete           Available                                   local-storage            91s\nlocal-pv-f1c0babe   39Gi       RWO            Delete           Available                                   local-storage            92s\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br")])]),e("h2",{attrs:{id:"部署-tidb-cluster"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#部署-tidb-cluster","aria-hidden":"true"}},[s._v("#")]),s._v(" 部署 TiDB Cluster")]),s._v(" "),e("ul",[e("li",[s._v("通过 "),e("code",[s._v("helm")]),s._v(" 和 TiDB Operator，我们可以很轻松的部署一套 TiDB 集群")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("helm install charts/tidb-cluster --name=tidb-cluster --namespace=tidb --version=v1.0.0-rc.1\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("等待几分钟，确保 TiDB 所有组件正常创建并进入 "),e("code",[s._v("ready")]),s._v(" 状态，可以通过下面命令持续观察")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("watch")]),s._v(" kubectl get pods --namespace tidb -l app.kubernetes.io/instance"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("tidb-cluster -o wide\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 输出如下")]),s._v("\ntidb-cluster-discovery-d7498f865-mmjnc   1/1     Running   0          39s   10.244.2.3       kubernetes-node-03   "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\ntidb-cluster-monitor-76f98d655d-rv8kf    2/2     Running   0          39s   10.244.140.69    kubernetes-node-02   "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\ntidb-cluster-pd-0                        1/1     Running   0          36s   10.244.2.4       kubernetes-node-03   "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\ntidb-cluster-pd-1                        1/1     Running   0          36s   10.244.140.70    kubernetes-node-02   "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\ntidb-cluster-pd-2                        1/1     Running   0          36s   10.244.141.195   kubernetes-node-01   "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("ul",[e("li",[s._v("获取集群信息")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("kubectl get tidbcluster -n tidb\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 输出如下")]),s._v("\nNAME           PD                  STORAGE   READY   DESIRE   TIKV                  STORAGE   READY   DESIRE   TIDB                  READY   DESIRE\ntidb-cluster   pingcap/pd:v3.0.1   1Gi       3       3        pingcap/tikv:v3.0.1   10Gi      3       3        pingcap/tidb:v3.0.1   2       2\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("kubectl get statefulset -n tidb\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 输出如下")]),s._v("\nNAME                READY   AGE\ntidb-cluster-pd     3/3     15m\ntidb-cluster-tidb   2/2     11m\ntidb-cluster-tikv   3/3     14m\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("kubectl get "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" -n tidb\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 输出如下")]),s._v("\nNAME                      TYPE        CLUSTER-IP       EXTERNAL-IP   PORT"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("S"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                          AGE\ntidb-cluster-discovery    ClusterIP   10.98.237.230    "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        10261/TCP                        16m\ntidb-cluster-grafana      NodePort    10.108.6.182     "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        3000:31671/TCP                   16m\ntidb-cluster-pd           ClusterIP   10.106.96.125    "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        2379/TCP                         16m\ntidb-cluster-pd-peer      ClusterIP   None             "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        2380/TCP                         16m\ntidb-cluster-prometheus   NodePort    10.104.16.19     "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        9090:31392/TCP                   16m\ntidb-cluster-tidb         NodePort    10.100.103.145   "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        4000:31652/TCP,10080:30100/TCP   16m\ntidb-cluster-tidb-peer    ClusterIP   None             "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        10080/TCP                        12m\ntidb-cluster-tikv-peer    ClusterIP   None             "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        20160/TCP                        14m\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br")])]),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("kubectl get configmap -n tidb\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 输出如下")]),s._v("\nNAME                                      DATA   AGE\ntidb-cluster-monitor                      5      17m\ntidb-cluster-monitor-dashboard-extra-v3   2      17m\ntidb-cluster-monitor-dashboard-v2         5      17m\ntidb-cluster-monitor-dashboard-v3         5      17m\ntidb-cluster-pd-aa6df71f                  2      17m\ntidb-cluster-tidb                         2      17m\ntidb-cluster-tidb-a4c4bb14                2      17m\ntidb-cluster-tikv-e0d21970                2      17m\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br")])]),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("kubectl get pod -n tidb\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 输出如下")]),s._v("\nNAME                                     READY   STATUS    RESTARTS   AGE\ntidb-cluster-discovery-d7498f865-zmqj8   1/1     Running   0          18m\ntidb-cluster-monitor-76f98d655d-x2drs    2/2     Running   0          18m\ntidb-cluster-pd-0                        1/1     Running   0          18m\ntidb-cluster-pd-1                        1/1     Running   0          17m\ntidb-cluster-pd-2                        1/1     Running   1          17m\ntidb-cluster-tidb-0                      2/2     Running   0          14m\ntidb-cluster-tidb-1                      2/2     Running   0          14m\ntidb-cluster-tikv-0                      1/1     Running   0          16m\ntidb-cluster-tikv-1                      1/1     Running   0          16m\ntidb-cluster-tikv-2                      1/1     Running   0          16m\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br")])]),e("h3",{attrs:{id:"访问数据库"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#访问数据库","aria-hidden":"true"}},[s._v("#")]),s._v(" 访问数据库")]),s._v(" "),e("p",[s._v("通过 "),e("code",[s._v("kubectl port-forward")]),s._v(" 暴露服务到主机，可以访问 TiDB 集群。命令中的端口格式为："),e("code",[s._v("<主机端口>:<k8s 服务端口>")])]),s._v(" "),e("blockquote",[e("p",[e("strong",[s._v("注意：")]),s._v(" 如果你不是在本地 PC 而是在远程主机上部署的 DinD 环境，可能无法通过 localhost 访问远程主机的服务。如果使用 "),e("code",[s._v("kubectl")]),s._v(" 1.13 或者更高版本，可以在执行 "),e("code",[s._v("kubectl port-forward")]),s._v(" 命令时添加 "),e("code",[s._v("--address 0.0.0.0")]),s._v(" 选项，在 "),e("code",[s._v("0.0.0.0")]),s._v(" 暴露端口而不是默认的 "),e("code",[s._v("127.0.0.1")])])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("kubectl port-forward svc/tidb-cluster-tidb 4000:4000 --namespace"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("tidb --address 0.0.0.0\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[e("img",{attrs:{src:"https://p-blog.gitee.io/pic-repo/images/kubernetes/kube20190911013729.png",alt:""}})]),s._v(" "),e("ul",[e("li",[s._v("版本：MySQL 5.7.25")]),s._v(" "),e("li",[s._v("账号：root")]),s._v(" "),e("li",[s._v("密码：空")])]),s._v(" "),e("blockquote",[e("p",[e("strong",[s._v("注意：")]),s._v(" 目前 TiDB 只支持 MySQL5.7 版本客户端 8.0 会报 "),e("code",[s._v("ERROR 1105 (HY000): Unknown charset id 255")])])]),s._v(" "),e("h3",{attrs:{id:"查看监控面板"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#查看监控面板","aria-hidden":"true"}},[s._v("#")]),s._v(" 查看监控面板")]),s._v(" "),e("p",[s._v("使用 "),e("code",[s._v("kubectl")]),s._v(" 暴露 Grafana 服务端口")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("kubectl port-forward svc/tidb-cluster-grafana 3000:3000 --namespace=tidb --address 0.0.0.0\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("在浏览器中打开 "),e("code",[s._v("http://192.168.141.110:3000")]),s._v(" 访问 Grafana 监控面板")]),s._v(" "),e("ul",[e("li",[s._v("账号：admin")]),s._v(" "),e("li",[s._v("密码：admin")])]),s._v(" "),e("p",[e("img",{attrs:{src:"https://p-blog.gitee.io/pic-repo/images/kubernetes/kube12b04ad790fb756c.png",alt:""}})]),s._v(" "),e("h2",{attrs:{id:"销毁-tidb-cluster"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#销毁-tidb-cluster","aria-hidden":"true"}},[s._v("#")]),s._v(" 销毁 TiDB Cluster")]),s._v(" "),e("p",[s._v("测试结束后，使用如下命令销毁 TiDB 集群")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("helm delete tidb-cluster --purge\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("blockquote",[e("p",[e("strong",[s._v("注意：")]),s._v(" 上述命令只是删除运行的 Pod，数据仍然会保留。")])]),s._v(" "),e("p",[s._v("如果你不再需要那些数据，可以通过下面命令清除数据（"),e("strong",[s._v("这将永久删除数据")]),s._v("）")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("kubectl get "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("pv")]),s._v(" -l app.kubernetes.io/namespace"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("tidb -o name "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("xargs")]),s._v(" -I "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" kubectl patch "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" -p "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'{"spec":{"persistentVolumeReclaimPolicy":"Delete"}}\'')]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" \\kubectl delete pvc --namespace tidb --all\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h2",{attrs:{id:"其它小记"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#其它小记","aria-hidden":"true"}},[s._v("#")]),s._v(" 其它小记")]),s._v(" "),e("ul",[e("li",[e("code",[s._v("1 node(s) had taints that the pod didn't tolerate")]),s._v("：默认 k8s 不允许往 master 节点装东西，强行设置下允许（下面的 "),e("code",[s._v("kubernetes-master")]),s._v(" 是主节点的名称）")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 允许 Master 节点部署 Pod")]),s._v("\nkubectl taint nodes --all node-role.kubernetes.io/master-\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 禁止 Master 节点部署 Pod")]),s._v("\nkubectl taint nodes kubernetes-master node-role.kubernetes.io/master"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true:NoSchedule\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("ul",[e("li",[s._v("删除全部 PV")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("kubectl delete "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("pv")]),s._v(" --all\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("卸载挂载目录")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("DISK_UUID"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("blkid -s UUID -o value /dev/sdb"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" i "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("seq")]),s._v(" 1 10"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("umount")]),s._v(" /mnt/disks/"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${DISK_UUID}")]),s._v("_vol"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${i}")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -fr /mnt\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("ul",[e("li",[s._v("删除 "),e("code",[s._v("/etc/fstab")]),s._v(" 配置中挂载的目录")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("UUID"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("062815c7-b202-41ef-a5fb-77c783792737 / ext4 defaults 0 0\nUUID"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("e8717c59-6d9b-4709-9303-b2161a57912b /boot ext4 defaults 0 0\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#/swap.img      none    swap    sw      0       0")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 卸载挂载目录后需要删除如下内容")]),s._v("\nUUID"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("58759186-ffab-42a3-96ce-f9d3c355d4d1 /mnt/58759186-ffab-42a3-96ce-f9d3c355d4d1 ext4 defaults 0 2\n/mnt/58759186-ffab-42a3-96ce-f9d3c355d4d1/vol1 /mnt/disks/58759186-ffab-42a3-96ce-f9d3c355d4d1_vol1 none bind 0 0\n/mnt/58759186-ffab-42a3-96ce-f9d3c355d4d1/vol2 /mnt/disks/58759186-ffab-42a3-96ce-f9d3c355d4d1_vol2 none bind 0 0\n/mnt/58759186-ffab-42a3-96ce-f9d3c355d4d1/vol3 /mnt/disks/58759186-ffab-42a3-96ce-f9d3c355d4d1_vol3 none bind 0 0\n/mnt/58759186-ffab-42a3-96ce-f9d3c355d4d1/vol4 /mnt/disks/58759186-ffab-42a3-96ce-f9d3c355d4d1_vol4 none bind 0 0\n/mnt/58759186-ffab-42a3-96ce-f9d3c355d4d1/vol5 /mnt/disks/58759186-ffab-42a3-96ce-f9d3c355d4d1_vol5 none bind 0 0\n/mnt/58759186-ffab-42a3-96ce-f9d3c355d4d1/vol6 /mnt/disks/58759186-ffab-42a3-96ce-f9d3c355d4d1_vol6 none bind 0 0\n/mnt/58759186-ffab-42a3-96ce-f9d3c355d4d1/vol7 /mnt/disks/58759186-ffab-42a3-96ce-f9d3c355d4d1_vol7 none bind 0 0\n/mnt/58759186-ffab-42a3-96ce-f9d3c355d4d1/vol8 /mnt/disks/58759186-ffab-42a3-96ce-f9d3c355d4d1_vol8 none bind 0 0\n/mnt/58759186-ffab-42a3-96ce-f9d3c355d4d1/vol9 /mnt/disks/58759186-ffab-42a3-96ce-f9d3c355d4d1_vol9 none bind 0 0\n/mnt/58759186-ffab-42a3-96ce-f9d3c355d4d1/vol10 /mnt/disks/58759186-ffab-42a3-96ce-f9d3c355d4d1_vol10 none bind 0 0\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br")])])])},[],!1,null,null,null);a.default=n.exports}}]);