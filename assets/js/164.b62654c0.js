(window.webpackJsonp=window.webpackJsonp||[]).push([[164],{378:function(s,t,n){"use strict";n.r(t);var a=n(2),e=Object(a.a)({},function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"kubernetes-搭建集群"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#kubernetes-搭建集群","aria-hidden":"true"}},[s._v("#")]),s._v(" Kubernetes 搭建集群")]),s._v(" "),n("h2",{attrs:{id:"概述"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#概述","aria-hidden":"true"}},[s._v("#")]),s._v(" 概述")]),s._v(" "),n("p",[s._v("kubeadm 是 kubernetes 的集群安装工具，能够快速安装 kubernetes 集群，安装 kubernetes 主要是安装它的各个镜像，而 kubeadm 已经为我们集成好了运行 kubernetes 所需的基本镜像。但由于国内的网络原因，在搭建环境时，无法拉取到这些镜像。此时我们只需要修改为阿里云提供的镜像服务即可解决该问题。")]),s._v(" "),n("h2",{attrs:{id:"创建并修改配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#创建并修改配置","aria-hidden":"true"}},[s._v("#")]),s._v(" 创建并修改配置")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 导出配置文件")]),s._v("\nkubeadm config print init-defaults --kubeconfig ClusterConfiguration "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" kubeadm.yml\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("apiVersion: kubeadm.k8s.io/v1beta2\nbootstrapTokens:\n- groups:\n  - system:bootstrappers:kubeadm:default-node-token\n  token: abcdef.0123456789abcdef\n  ttl: 24h0m0s\n  usages:\n  - signing\n  - authentication\nkind: InitConfiguration\nlocalAPIEndpoint:\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改为主节点 IP")]),s._v("\n  advertiseAddress: 192.168.141.110\n  bindPort: 6443\nnodeRegistration:\n  criSocket: /var/run/dockershim.sock\n  name: kubernetes-master\n  taints:\n  - effect: NoSchedule\n    key: node-role.kubernetes.io/master\n---\napiServer:\n  timeoutForControlPlane: 4m0s\napiVersion: kubeadm.k8s.io/v1beta2\ncertificatesDir: /etc/kubernetes/pki\nclusterName: kubernetes\ncontrollerManager: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\ndns:\n  type: CoreDNS\netcd:\n  local:\n    dataDir: /var/lib/etcd\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 国内不能访问 Google，修改为阿里云")]),s._v("\nimageRepository: registry.aliyuncs.com/google_containers\nkind: ClusterConfiguration\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改版本号")]),s._v("\nkubernetesVersion: v1.15.2\nnetworking:\n  dnsDomain: cluster.local\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置 POD 所在网段为我们虚拟机不重叠的网段（这里用的是 Flannel 默认网段）")]),s._v("\n  podSubnet: "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10.244.0.0/16"')]),s._v("\n  serviceSubnet: 10.96.0.0/12\nscheduler: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br")])]),n("h2",{attrs:{id:"查看所需镜像"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#查看所需镜像","aria-hidden":"true"}},[s._v("#")]),s._v(" 查看所需镜像")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("kubeadm config images list --config kubeadm.yml\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 输出如下")]),s._v("\nregistry.aliyuncs.com/google_containers/kube-apiserver:v1.15.0\nregistry.aliyuncs.com/google_containers/kube-controller-manager:v1.15.0\nregistry.aliyuncs.com/google_containers/kube-scheduler:v1.15.0\nregistry.aliyuncs.com/google_containers/kube-proxy:v1.15.0\nregistry.aliyuncs.com/google_containers/pause:3.1\nregistry.aliyuncs.com/google_containers/etcd:3.3.10\nregistry.aliyuncs.com/google_containers/coredns:1.3.1\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("h2",{attrs:{id:"拉取所需镜像"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#拉取所需镜像","aria-hidden":"true"}},[s._v("#")]),s._v(" 拉取所需镜像")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("kubeadm config images pull --config kubeadm.yml\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 输出如下")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("config/images"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Pulled registry.aliyuncs.com/google_containers/kube-apiserver:v1.15.0\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("config/images"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Pulled registry.aliyuncs.com/google_containers/kube-controller-manager:v1.15.0\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("config/images"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Pulled registry.aliyuncs.com/google_containers/kube-scheduler:v1.15.0\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("config/images"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Pulled registry.aliyuncs.com/google_containers/kube-proxy:v1.15.0\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("config/images"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Pulled registry.aliyuncs.com/google_containers/pause:3.1\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("config/images"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Pulled registry.aliyuncs.com/google_containers/etcd:3.3.10\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("config/images"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Pulled registry.aliyuncs.com/google_containers/coredns:1.3.1\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("h2",{attrs:{id:"安装主节点"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安装主节点","aria-hidden":"true"}},[s._v("#")]),s._v(" 安装主节点")]),s._v(" "),n("p",[s._v("执行以下命令初始化主节点，该命令指定了初始化时需要使用的配置文件，其中添加 "),n("code",[s._v("--upload-certs")]),s._v(" 参数可以在后续执行加入节点时自动分发证书文件。追加的 "),n("code",[s._v("tee kubeadm-init.log")]),s._v(" 用以输出日志。")]),s._v(" "),n("blockquote",[n("p",[s._v("注意： 如果安装 kubernetes 版本和下载的镜像版本不统一则会出现 timed out waiting for the condition 错误。中途失败或是想修改配置可以使用 kubeadm reset 命令重置配置，再做初始化操作即可。")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("kubeadm init --config"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("kubeadm.yml --upload-certs "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("tee")]),s._v(" kubeadm-init.log\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 输出如下")]),s._v("\nFlag --experimental-upload-certs has been deprecated, use --upload-certs instead\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("init"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Using Kubernetes version: v1.15.2\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("preflight"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Running pre-flight checks\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("WARNING IsDockerSystemdCheck"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": detected "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cgroupfs"')]),s._v(" as the Docker cgroup driver. The recommended driver is "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"systemd"')]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v(".")]),s._v(" Please follow the guide at https://kubernetes.io/docs/setup/cri/\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("preflight"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Pulling images required "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" setting up a Kubernetes cluster\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("preflight"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" This might take a minute or two, depending on the speed of your internet connection\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("preflight"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" You can also perform this action "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" beforehand using "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'kubeadm config images pull'")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("kubelet-start"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Writing kubelet environment "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" with flags to "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/var/lib/kubelet/kubeadm-flags.env"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("kubelet-start"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Writing kubelet configuration to "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/var/lib/kubelet/config.yaml"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("kubelet-start"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Activating the kubelet "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("certs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Using certificateDir folder "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/etc/kubernetes/pki"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("certs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Generating "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"etcd/ca"')]),s._v(" certificate and key\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("certs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Generating "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"etcd/healthcheck-client"')]),s._v(" certificate and key\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("certs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Generating "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"apiserver-etcd-client"')]),s._v(" certificate and key\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("certs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Generating "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"etcd/server"')]),s._v(" certificate and key\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("certs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" etcd/server serving cert is signed "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" DNS names "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("kubernetes-master localhost"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" and IPs "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("192.168.141.110 127.0.0.1 ::1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("certs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Generating "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"etcd/peer"')]),s._v(" certificate and key\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("certs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" etcd/peer serving cert is signed "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" DNS names "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("kubernetes-master localhost"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" and IPs "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("192.168.141.110 127.0.0.1 ::1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("certs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Generating "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"front-proxy-ca"')]),s._v(" certificate and key\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("certs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Generating "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"front-proxy-client"')]),s._v(" certificate and key\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("certs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Generating "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ca"')]),s._v(" certificate and key\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("certs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Generating "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"apiserver"')]),s._v(" certificate and key\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("certs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" apiserver serving cert is signed "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" DNS names "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("kubernetes-master kubernetes kubernetes.default kubernetes.default.svc kubernetes.default.svc.cluster.local"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" and IPs "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("10.96.0.1 192.168.141.110"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("certs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Generating "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"apiserver-kubelet-client"')]),s._v(" certificate and key\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("certs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Generating "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sa"')]),s._v(" key and public key\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("kubeconfig"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Using kubeconfig folder "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/etc/kubernetes"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("kubeconfig"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Writing "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"admin.conf"')]),s._v(" kubeconfig "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("kubeconfig"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Writing "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kubelet.conf"')]),s._v(" kubeconfig "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("kubeconfig"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Writing "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"controller-manager.conf"')]),s._v(" kubeconfig "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("kubeconfig"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Writing "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"scheduler.conf"')]),s._v(" kubeconfig "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("control-plane"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Using manifest folder "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/etc/kubernetes/manifests"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("control-plane"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Creating static Pod manifest "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kube-apiserver"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("control-plane"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Creating static Pod manifest "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kube-controller-manager"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("control-plane"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Creating static Pod manifest "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kube-scheduler"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("etcd"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Creating static Pod manifest "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" local etcd "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/etc/kubernetes/manifests"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("wait-control-plane"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Waiting "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" the kubelet to boot up the control plane as static Pods from directory "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/etc/kubernetes/manifests"')]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v(".")]),s._v(" This can take up to 4m0s\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("apiclient"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" All control plane components are healthy after 24.003332 seconds\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("upload-config"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Storing the configuration used "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" ConfigMap "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kubeadm-config"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" the "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kube-system"')]),s._v(" Namespace\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("kubelet"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Creating a ConfigMap "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kubelet-config-1.15"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" namespace kube-system with the configuration "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" the kubelets "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" the cluster\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("upload-certs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Storing the certificates "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" Secret "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kubeadm-certs"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" the "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kube-system"')]),s._v(" Namespace\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("upload-certs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Using certificate key:\n4f9e984aba82be83600bf19e4bb0fb317ecfb578698cbb99c9e7b1099e559d66\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mark-control-plane"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Marking the node kubernetes-master as control-plane by adding the label "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"node-role.kubernetes.io/master=''\"")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mark-control-plane"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Marking the node kubernetes-master as control-plane by adding the taints "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("node-role.kubernetes.io/master:NoSchedule"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("bootstrap-token"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Using token: abcdef.0123456789abcdef\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("bootstrap-token"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Configuring bootstrap tokens, cluster-info ConfigMap, RBAC Roles\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("bootstrap-token"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" configured RBAC rules to allow Node Bootstrap tokens to post CSRs "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" order "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" nodes to get long term certificate credentials\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("bootstrap-token"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("bootstrap-token"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" configured RBAC rules to allow certificate rotation "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" all node client certificates "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" the cluster\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("bootstrap-token"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Creating the "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cluster-info"')]),s._v(" ConfigMap "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" the "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kube-public"')]),s._v(" namespace\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("addons"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Applied essential addon: CoreDNS\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("addons"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Applied essential addon: kube-proxy\n\nYour Kubernetes control-plane has initialized successfully"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("\n\nTo start using your cluster, you need to run the following as a regular user:\n\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$HOME")]),s._v("/.kube\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" -i /etc/kubernetes/admin.conf "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$HOME")]),s._v("/.kube/config\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" -u"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" -g"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$HOME")]),s._v("/.kube/config\n\nYou should now deploy a pod network to the cluster.\nRun "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kubectl apply -f [podnetwork].yaml"')]),s._v(" with one of the options listed at:\n  https://kubernetes.io/docs/concepts/cluster-administration/addons/\n\nThen you can "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("join")]),s._v(" any number of worker nodes by running the following on each as root:\n\nkubeadm "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("join")]),s._v(" 192.168.141.110:6443 --token abcdef.0123456789abcdef \\\n    --discovery-token-ca-cert-hash sha256:822e5d6dd8f770b20f21df1a4f9053b1f44ea5ab934bbc59697efbf1533c64c0\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br")])]),n("h2",{attrs:{id:"配置-kubectl"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#配置-kubectl","aria-hidden":"true"}},[s._v("#")]),s._v(" 配置 kubectl")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$HOME")]),s._v("/.kube\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" -i /etc/kubernetes/admin.conf "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$HOME")]),s._v("/.kube/config\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 非 ROOT 用户执行")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" -u"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" -g"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$HOME")]),s._v("/.kube/config\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h2",{attrs:{id:"验证是否成功"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#验证是否成功","aria-hidden":"true"}},[s._v("#")]),s._v(" 验证是否成功")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("kubectl get node\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 输出如下")]),s._v("\nNAME                STATUS     ROLES    AGE     VERSION\nkubernetes-master   NotReady   master   4m38s   v1.15.2\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h2",{attrs:{id:"安装从节点"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安装从节点","aria-hidden":"true"}},[s._v("#")]),s._v(" 安装从节点")]),s._v(" "),n("p",[s._v("将 Node 节点加入到集群中很简单，只需要在 Node 服务器上安装 kubeadm，kubectl，kubelet 三个工具，然后使用 "),n("code",[s._v("kubeadm join")]),s._v(" 命令加入即可")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('kubeadm join 192.168.141.110:6443 --token abcdef.0123456789abcdef \\\n    --discovery-token-ca-cert-hash sha256:822e5d6dd8f770b20f21df1a4f9053b1f44ea5ab934bbc59697efbf1533c64c0\n\n# 输出如下\n[preflight] Running pre-flight checks\n        [WARNING IsDockerSystemdCheck]: detected "cgroupfs" as the Docker cgroup driver. The recommended driver is "systemd". Please follow the guide at https://kubernetes.io/docs/setup/cri/\n[preflight] Reading configuration from the cluster...\n[preflight] FYI: You can look at this config file with \'kubectl -n kube-system get cm kubeadm-config -oyaml\'\n[kubelet-start] Downloading configuration for the kubelet from the "kubelet-config-1.15" ConfigMap in the kube-system namespace\n[kubelet-start] Writing kubelet configuration to file "/var/lib/kubelet/config.yaml"\n[kubelet-start] Writing kubelet environment file with flags to file "/var/lib/kubelet/kubeadm-flags.env"\n[kubelet-start] Activating the kubelet service\n[kubelet-start] Waiting for the kubelet to perform the TLS Bootstrap...\nThis node has joined the cluster:\n* Certificate signing request was sent to apiserver and a response was received.\n* The Kubelet was informed of the new secure connection details.\nRun \'kubectl get nodes\' on the control-plane to see this node join the cluster.\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br")])]),n("h2",{attrs:{id:"验证是否成功-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#验证是否成功-2","aria-hidden":"true"}},[s._v("#")]),s._v(" 验证是否成功")]),s._v(" "),n("p",[s._v("回到 Master 主节点查看是否安装成功")]),s._v(" "),n("blockquote",[n("p",[s._v("注意： 如果 Node 节点加入 Master 时配置有问题可以在 Node 节点上使用 "),n("code",[s._v("kubeadm reset")]),s._v(" 重置配置再使用 "),n("code",[s._v("kubeadm join")]),s._v(" 命令重新加入即可。希望在 master 节点删除 node ，可以使用 "),n("code",[s._v("kubeadm delete nodes <NAME>")]),s._v(" 删除。")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("kubectl get node\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 输出如下")]),s._v("\nNAME                 STATUS     ROLES    AGE   VERSION\nkubernetes-master    NotReady   master   20m   v1.15.2\nkubernetes-node-01   NotReady   "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("   16s   v1.15.2\nkubernetes-node-02   NotReady   "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("   6s    v1.15.2\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("h2",{attrs:{id:"查看-pod-状态"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#查看-pod-状态","aria-hidden":"true"}},[s._v("#")]),s._v(" 查看 Pod 状态")]),s._v(" "),n("p",[s._v("coredns 尚未运行，此时我们还需要安装网络插件")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("kubectl get pod -n kube-system -o wide\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 输出如下")]),s._v("\nNAME                                        READY   STATUS    RESTARTS   AGE     IP                NODE                 NOMINATED NODE   READINESS GATES\ncoredns-bccdc95cf-9s4bm                     0/1     Pending   0          24m     "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("            "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("               "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\ncoredns-bccdc95cf-s8ggd                     0/1     Pending   0          24m     "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("            "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("               "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\netcd-kubernetes-master                      1/1     Running   0          24m     192.168.141.110   kubernetes-master    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nkube-apiserver-kubernetes-master            1/1     Running   0          24m     192.168.141.110   kubernetes-master    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nkube-controller-manager-kubernetes-master   1/1     Running   0          23m     192.168.141.110   kubernetes-master    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nkube-proxy-8s87d                            1/1     Running   0          4m56s   192.168.141.120   kubernetes-node-01   "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nkube-proxy-cbnlb                            1/1     Running   0          4m46s   192.168.141.121   kubernetes-node-02   "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nkube-proxy-vwhxj                            1/1     Running   0          24m     192.168.141.110   kubernetes-master    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nkube-scheduler-kubernetes-master            1/1     Running   0          24m     192.168.141.110   kubernetes-master    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])]),n("h2",{attrs:{id:"附：扩展阅读"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#附：扩展阅读","aria-hidden":"true"}},[s._v("#")]),s._v(" 附：扩展阅读")]),s._v(" "),n("h3",{attrs:{id:"kubeadm-init-的执行过程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#kubeadm-init-的执行过程","aria-hidden":"true"}},[s._v("#")]),s._v(" kubeadm init 的执行过程")]),s._v(" "),n("ul",[n("li",[n("strong",[s._v("init：")]),s._v(" 指定版本进行初始化操作")]),s._v(" "),n("li",[n("strong",[s._v("preflight：")]),s._v(" 初始化前的检查和下载所需要的 Docker 镜像文件")]),s._v(" "),n("li",[n("strong",[s._v("kubelet-start：")]),s._v(" 生成 kubelet 的配置文件 "),n("code",[s._v("var/lib/kubelet/config.yaml")]),s._v("，没有这个文件 kubelet 无法启动，所以初始化之前的 kubelet 实际上启动不会成功")]),s._v(" "),n("li",[n("strong",[s._v("certificates：")]),s._v(" 生成 Kubernetes 使用的证书，存放在 "),n("code",[s._v("/etc/kubernetes/pki")]),s._v(" 目录中")]),s._v(" "),n("li",[n("strong",[s._v("kubeconfig：")]),s._v(" 生成 KubeConfig 文件，存放在 "),n("code",[s._v("/etc/kubernetes")]),s._v(" 目录中，组件之间通信需要使用对应文件")]),s._v(" "),n("li",[n("strong",[s._v("control-plane：")]),s._v(" 使用 "),n("code",[s._v("/etc/kubernetes/manifest")]),s._v(" 目录下的 YAML 文件，安装 Master 组件")]),s._v(" "),n("li",[n("strong",[s._v("etcd：")]),s._v(" 使用 "),n("code",[s._v("/etc/kubernetes/manifest/etcd.yaml")]),s._v(" 安装 Etcd 服务")]),s._v(" "),n("li",[n("strong",[s._v("wait-control-plane：")]),s._v(" 等待 control-plan 部署的 Master 组件启动")]),s._v(" "),n("li",[n("strong",[s._v("apiclient：")]),s._v(" 检查 Master 组件服务状态。")]),s._v(" "),n("li",[n("strong",[s._v("uploadconfig：")]),s._v(" 更新配置")]),s._v(" "),n("li",[n("strong",[s._v("kubelet：")]),s._v(" 使用 configMap 配置 kubelet")]),s._v(" "),n("li",[n("strong",[s._v("patchnode：")]),s._v(" 更新 CNI 信息到 Node 上，通过注释的方式记录")]),s._v(" "),n("li",[n("strong",[s._v("mark-control-plane：")]),s._v(" 为当前节点打标签，打了角色 Master，和不可调度标签，这样默认就不会使用 Master 节点来运行 Pod")]),s._v(" "),n("li",[n("strong",[s._v("bootstrap-token：")]),s._v(" 生成 token 记录下来，后边使用 "),n("code",[s._v("kubeadm join")]),s._v(" 往集群中添加节点时会用到")]),s._v(" "),n("li",[n("strong",[s._v("addons：")]),s._v(" 安装附加组件 CoreDNS 和 kube-proxy")])])])},[],!1,null,null,null);t.default=e.exports}}]);